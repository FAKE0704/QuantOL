# QuantOL - åŸºäºäº‹ä»¶é©±åŠ¨çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿ
[![Python](https://img.shields.io/badge/Python-3.9+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-green.svg)](https://fastapi.tiangolo.com/)
[![React](https://img.shields.io/badge/React-18+-blue.svg)](https://react.dev/)
[![Next.js](https://img.shields.io/badge/Next.js-14+-black.svg)](https://nextjs.org/)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)](https://streamlit.io/)
[![Nginx](https://img.shields.io/badge/Nginx-1.24+-green.svg)](https://nginx.org/)
[![Redis](https://img.shields.io/badge/Redis-7.0+-red.svg)](https://redis.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-blue.svg)](https://www.postgresql.org/)
[![SQLite](https://img.shields.io/badge/SQLite-3.0+-green.svg)](https://www.sqlite.org/)
[![WebSocket](https://img.shields.io/badge/WebSocket-API-orange.svg)](https://websockets.ws/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)

ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨æ¶æ„çš„ä¸“ä¸šé‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„ç­–ç•¥å¼€å‘ã€å›æµ‹åˆ†æå’Œäº¤æ˜“æ‰§è¡ŒåŠŸèƒ½ã€‚é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå®æ—¶è¿›åº¦è¿½è¸ªå’Œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œã€‚

## âœ¨ ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- **äº‹ä»¶é©±åŠ¨æ¶æ„** - åŸºäºæ¶ˆæ¯æ€»çº¿çš„æ¾è€¦åˆè®¾è®¡
- **å‰åç«¯åˆ†ç¦»** - React/Next.js å‰ç«¯ + FastAPI åç«¯
- **å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ** - æ”¯æŒåå°å›æµ‹å’Œå®æ—¶è¿›åº¦è¿½è¸ª
- **WebSocket é€šä¿¡** - å®æ—¶æ¨é€å›æµ‹è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°
- **Redis çŠ¶æ€å­˜å‚¨** - æŒä¹…åŒ–å›æµ‹çŠ¶æ€å’Œç»“æœ
- **Nginx åå‘ä»£ç†** - ç»Ÿä¸€å…¥å£ï¼Œæ”¯æŒ WebSocket ä»£ç†
- **åŒæ•°æ®åº“æ¨¡å¼** - æ”¯æŒSQLite(å¿«é€Ÿä½“éªŒ)å’ŒPostgreSQL(ç”Ÿäº§ç¯å¢ƒ)
- **å¤šæ•°æ®æºæ”¯æŒ** - Tushareã€Baostockã€AkShareç­‰æ•°æ®æºé›†æˆ
- **ç­–ç•¥å›æµ‹å¼•æ“** - æ”¯æŒå¤šè‚¡ç¥¨ç»„åˆå›æµ‹å’Œè§„åˆ™ç»„ç®¡ç†
- **é£é™©æ§åˆ¶ç³»ç»Ÿ** - å®Œæ•´çš„èµ„é‡‘ç®¡ç†å’Œé£é™©æ§åˆ¶æœºåˆ¶
- **åŒé‡ç•Œé¢** - Reactæ–°ç‰ˆç•Œé¢ + Streamlitç»å…¸ç•Œé¢

### ğŸ“Š ç­–ç•¥æ”¯æŒ
- **è§„åˆ™ç­–ç•¥** - æ”¯æŒæŠ€æœ¯æŒ‡æ ‡ç»„åˆå’Œè‡ªå®šä¹‰è§„åˆ™
- **ä»“ä½ç®¡ç†** - å›ºå®šæ¯”ä¾‹ã€å‡¯åˆ©å…¬å¼ã€é©¬ä¸æ ¼å°”ç­‰å¤šç§ä»“ä½ç­–ç•¥
- **å¤šè‚¡ç¥¨ç»„åˆ** - æ”¯æŒå¤šè‚¡ç¥¨ç­–ç•¥æ˜ å°„å’Œèµ„é‡‘åˆ†é…
- **æŠ€æœ¯æŒ‡æ ‡** - MAã€MACDã€RSIã€å¸ƒæ—å¸¦ç­‰å¸¸ç”¨æŒ‡æ ‡

### ğŸ¯ ä¸“ä¸šå·¥å…·
- **å›¾è¡¨æœåŠ¡** - Kçº¿å›¾ã€æˆäº¤é‡ã€èµ„é‡‘æµå‘ç­‰ä¸“ä¸šå›¾è¡¨
- **æ€§èƒ½åˆ†æ** - å¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ã€å¹´åŒ–æ”¶ç›Šç­‰æŒ‡æ ‡
- **äº¤æ˜“è®°å½•** - å®Œæ•´çš„äº¤æ˜“å†å²å’ŒæŒä»“ç®¡ç†
- **æ•°æ®ç®¡ç†** - å¼‚æ­¥æ•°æ®åŠ è½½å’Œç¼“å­˜æœºåˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.12+
- Node.js 20+ (ç”¨äº React å‰ç«¯)
- uv (åŒ…ç®¡ç†å™¨)
- **Redis**: 7.0+ (ç”¨äºçŠ¶æ€å­˜å‚¨)
- **Nginx**: 1.24+ (åå‘ä»£ç†)
- **æ•°æ®åº“**: SQLite 3.0+ (é»˜è®¤) æˆ– PostgreSQL 13+ (å¯é€‰)

### ğŸ—„ï¸ æ•°æ®åº“æ¨¡å¼é€‰æ‹©

æœ¬é¡¹ç›®æ”¯æŒä¸¤ç§æ•°æ®åº“æ¨¡å¼ï¼š

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| **SQLite** (é»˜è®¤) | å¿«é€Ÿä½“éªŒã€å¼€å‘æµ‹è¯• | é›¶é…ç½®ã€å¼€ç®±å³ç”¨ | æ€§èƒ½æœ‰é™ã€ä¸é€‚åˆå¤§æ•°æ®é‡ |
| **PostgreSQL** | ç”Ÿäº§ç¯å¢ƒã€å¤§æ•°æ®å¤„ç† | é«˜æ€§èƒ½ã€é«˜å¹¶å‘ | éœ€è¦é¢å¤–å®‰è£…é…ç½® |

### ğŸ“¦ å®‰è£…æ­¥éª¤

1. **å®‰è£…ä¾èµ–è½¯ä»¶**
```bash
# å®‰è£… Redis
# Ubuntu/Debian
sudo apt-get install redis-server

# macOS
brew install redis

# æˆ–ä½¿ç”¨ Docker
docker run -d -p 6379:6379 redis:7

# å®‰è£… Nginx
# Ubuntu/Debian
sudo apt-get install nginx

# macOS
brew install nginx
```

2. **å®‰è£… uv**
```bash
# Linux/macOS
curl -LsSf https://astral.sh/uv/install.sh | sh

# æˆ–ä½¿ç”¨åŒ…ç®¡ç†å™¨
pip install uv

# Windows (PowerShell)
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

3. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/FAKE0704/QuantOL.git
cd QuantOL
```

4. **å®‰è£…ä¾èµ–**
```bash
# Python ä¾èµ–
uv sync

# å‰ç«¯ä¾èµ–
cd landing-page && npm install && cd ..
```

5. **é…ç½®ç¯å¢ƒ**
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env
```

6. **å¯åŠ¨åº”ç”¨**
```bash
# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start.sh
```

å¯åŠ¨åè®¿é—®ï¼š- æ–°ç‰ˆç•Œé¢: http://localhost:8087
- Streamlit: http://localhost:8087/app

### ğŸ”„ æ•°æ®åº“æ¨¡å¼åˆ‡æ¢

#### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œåˆ‡æ¢
```bash
# åˆ‡æ¢åˆ°SQLiteæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
uv run python -m src.cli.database_switch switch --type sqlite

# åˆ‡æ¢åˆ°PostgreSQLæ¨¡å¼
uv run python -m src.cli.database_switch switch --type postgresql
```

#### æ–¹å¼äºŒï¼šWebç•Œé¢åˆ‡æ¢
1. å¯åŠ¨åº”ç”¨åï¼Œåœ¨å·¦ä¾§å¯¼èˆªæ é€‰æ‹©"ç³»ç»Ÿè®¾ç½®-æ•°æ®åº“è®¾ç½®"
2. ç‚¹å‡»ç›¸åº”æŒ‰é’®åˆ‡æ¢æ•°æ®åº“ç±»å‹
3. ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†é…ç½®å’Œåˆå§‹åŒ–

#### æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨é…ç½®
ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
# é€‰æ‹©æ•°æ®åº“ç±»å‹ (sqlite/postgresql)
DATABASE_TYPE=sqlite

# SQLiteé…ç½®
SQLITE_DB_PATH=./data/quantdb.sqlite

# PostgreSQLé…ç½® (å½“ä½¿ç”¨PostgreSQLæ—¶)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=quantdb
DB_USER=quant
DB_PASSWORD=your_password_here
```

### ğŸ˜ PostgreSQLæ¨¡å¼é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨PostgreSQLæ¨¡å¼ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤é…ç½®ï¼š

#### ä½¿ç”¨Dockerï¼ˆæ¨èï¼‰
```bash
# å¯åŠ¨PostgreSQLå®¹å™¨
docker-compose up -d

# éªŒè¯æ•°æ®åº“è¿è¡ŒçŠ¶æ€
docker-compose ps
```

#### ä½¿ç”¨æœ¬åœ°PostgreSQL
```bash
# macOS (ä½¿ç”¨Homebrew)
brew install postgresql
brew services start postgresql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
createdb quantdb
createuser quant
psql -d postgres -c "ALTER USER quant PASSWORD 'your_password';"
psql -d quantdb -c "GRANT ALL PRIVILEGES ON DATABASE quantdb TO quant;"

# å‚è§è¯¦ç»†æ–‡æ¡£: LOCAL_POSTGRES_SETUP.md
```

### ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

#### åŒ…ç®¡ç†
```bash
# åŒæ­¥ä¾èµ–ï¼ˆå®‰è£…/æ›´æ–°è™šæ‹Ÿç¯å¢ƒï¼‰
uv sync

# æ·»åŠ æ–°ä¾èµ–
uv add <package>

# æ›´æ–°æ‰€æœ‰ä¾èµ–
uv lock --upgrade
```

#### æ•°æ®åº“ç®¡ç†
```bash
# æŸ¥çœ‹å½“å‰æ•°æ®åº“çŠ¶æ€
uv run python -m src.cli.database_switch status

# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
uv run python -m src.cli.database_switch init

# åˆ‡æ¢æ•°æ®åº“ç±»å‹
uv run python -m src.cli.database_switch switch --type sqlite
uv run python -m src.cli.database_switch switch --type postgresql
```

#### åº”ç”¨ç®¡ç†
```bash
# å¯åŠ¨åº”ç”¨
uv run streamlit run main.py

# æŒ‡å®šç«¯å£å¯åŠ¨
uv run streamlit run main.py --server.port 8501

# å…è®¸å¤–éƒ¨è®¿é—®
uv run streamlit run main.py --server.address 0.0.0.0
```

### âš ï¸ æ³¨æ„äº‹é¡¹

- **SQLiteæ¨¡å¼**: æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ä¸­ï¼Œé€‚åˆå¼€å‘æµ‹è¯•å’Œä¸ªäººä½¿ç”¨
- **PostgreSQLæ¨¡å¼**: éœ€è¦æ•°æ®åº“æœåŠ¡è¿è¡Œï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒå’Œå›¢é˜Ÿä½¿ç”¨
- **æ•°æ®è¿ç§»**: ä¸¤ç§æ¨¡å¼é—´çš„æ•°æ®éœ€è¦æ‰‹åŠ¨è¿ç§»
- **æ€§èƒ½å·®å¼‚**: PostgreSQLåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶æ€§èƒ½æ›´ä¼˜

### ğŸ”§ æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜
1. **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€å’Œé…ç½®ä¿¡æ¯
2. **SQLiteæƒé™é”™è¯¯**: ç¡®ä¿æ•°æ®ç›®å½•æœ‰å†™å…¥æƒé™
3. **PostgreSQLè¿æ¥è¶…æ—¶**: æ£€æŸ¥é˜²ç«å¢™å’Œç½‘ç»œé…ç½®

#### è·å–å¸®åŠ©
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨"æ•°æ®åº“è®¾ç½®"é¡µé¢è¿›è¡Œè¿æ¥æµ‹è¯•
- æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼å’Œå‚æ•°

#### æ•°æ®æºé…ç½®
ç³»ç»Ÿæ”¯æŒå¤šç§æ•°æ®æºï¼Œå¯é€šè¿‡ç³»ç»Ÿè®¾ç½®é¡µé¢çµæ´»åˆ‡æ¢ï¼š

| æ•°æ®æº | ç‰¹ç‚¹ | é…ç½®è¦æ±‚ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|----------|
| **Tushare** | ä¸“ä¸šçº§é‡‘èæ•°æ®æ¥å£ | éœ€è¦æ³¨å†Œè·å–Token | ç”Ÿäº§ç¯å¢ƒã€ä¸“ä¸šåˆ†æ |
| **Baostock** | å…è´¹å¼€æºè¯åˆ¸æ•°æ®å¹³å° | æ— éœ€é…ç½® | å­¦ä¹ æµ‹è¯•ã€å¿«é€Ÿä½“éªŒ |
| **AkShare** | å¤šå¸‚åœºæ•°æ®æº | å¯é€‰APIå¯†é’¥ | å¤šå¸‚åœºæ•°æ®è·å– |

##### Tushareé…ç½® (æ¨è)
1. è®¿é—® [Tushareå®˜ç½‘](https://tushare.pro/register?reg=693641) æ³¨å†Œè´¦æˆ·
2. åœ¨ä¸ªäººä¸­å¿ƒè·å–API Token
3. åœ¨ç³»ç»Ÿè®¾ç½® â†’ æ•°æ®æºé…ç½®ä¸­è¾“å…¥Token
4. æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š
   ```bash
   TUSHARE_TOKEN=your_32_character_token_here
   SELECTED_DATA_SOURCE=Tushare
   ```

##### Baostocké…ç½® (é»˜è®¤)
- æ— éœ€ä»»ä½•é…ç½®ï¼Œå¼€ç®±å³ç”¨
- é€‚åˆå¿«é€Ÿä½“éªŒå’Œå­¦ä¹ æµ‹è¯•
- åœ¨ç³»ç»Ÿè®¾ç½®ä¸­ç›´æ¥é€‰æ‹©å³å¯ä½¿ç”¨

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒæ¨¡å—

```
QuantOL/
â”œâ”€â”€ src/                     # åç«¯æ ¸å¿ƒ
â”‚   â”œâ”€â”€ api/                 # FastAPI è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ models/          # Pydantic è¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ common.py           # é€šç”¨æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ backtest_requests.py
â”‚   â”‚   â”‚   â””â”€â”€ backtest_responses.py
â”‚   â”‚   â”œâ”€â”€ routers/         # API ç«¯ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ backtest/    # å›æµ‹è·¯ç”±å­åŒ… (æ¨¡å—åŒ–)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ execution.py      # æ‰§è¡Œç«¯ç‚¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ results.py        # ç»“æœç«¯ç‚¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ configs.py        # é…ç½®ç«¯ç‚¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ custom_strategies.py # ç­–ç•¥ç«¯ç‚¹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ logs.py           # æ—¥å¿—ç«¯ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py      # è®¤è¯ API
â”‚   â”‚   â”‚   â”œâ”€â”€ stocks.py    # è‚¡ç¥¨ API
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py # WebSocket API
â”‚   â”‚   â”œâ”€â”€ deps.py          # é€šç”¨ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ utils.py         # å…±äº«å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ server.py        # FastAPI åº”ç”¨
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ data/            # æ•°æ®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py  # æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ data_source.py
â”‚   â”‚   â”œâ”€â”€ strategy/        # ç­–ç•¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ backtesting.py      # å›æµ‹å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ rule_parser/        # è§„åˆ™è§£æå™¨åŒ… (æ¨¡å—åŒ–)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ expression_context.py    # è¯„ä¼°ä¸Šä¸‹æ–‡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ast_node_handler.py      # ASTæ“ä½œå·¥å…·
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cache_manager.py          # LRUç¼“å­˜ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ result_storage.py         # ç»“æœå­˜å‚¨ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cross_sectional_ranker.py # æ¨ªæˆªé¢æ’å
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rule_evaluator.py         # è¡¨è¾¾å¼è¯„ä¼°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rule_parser.py            # é—¨é¢ç±» (å‘åå…¼å®¹)
â”‚   â”‚   â”‚   â”œâ”€â”€ rule_based_strategy.py # è§„åˆ™ç­–ç•¥
â”‚   â”‚   â”‚   â””â”€â”€ position_strategy.py   # ä»“ä½ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ backtest/        # å›æµ‹å¼•æ“ (æ¨¡å—åŒ–)
â”‚   â”‚   â”‚   â”œâ”€â”€ protocols/    # åè®®æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ coordinators/ # åè°ƒå™¨
â”‚   â”‚   â”‚   â””â”€â”€ engine.py     # é‡æ„å¼•æ“
â”‚   â”‚   â”œâ”€â”€ execution/       # äº¤æ˜“æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ risk/            # é£é™©æ§åˆ¶
â”‚   â”‚   â””â”€â”€ portfolio/       # æŠ•èµ„ç»„åˆ
â”‚   â”œâ”€â”€ frontend/            # Streamlit ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ backtesting.py
â”‚   â”‚   â””â”€â”€ backtest_config_ui.py
â”‚   â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ interfaces/      # æœåŠ¡æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ backtest_state_service.py    # Redis çŠ¶æ€å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ backtest_task_manager.py     # å¼‚æ­¥ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ backtest_task_service.py     # ä»»åŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ websocket_manager.py         # WebSocket è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ chart_service.py             # å›¾è¡¨æœåŠ¡
â”‚   â”œâ”€â”€ event_bus/          # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ service_events.py            # æœåŠ¡äº‹ä»¶å®šä¹‰
â”‚   â”‚   â””â”€â”€ local_service_bus.py         # æœ¬åœ°æœåŠ¡æ€»çº¿
â”‚   â””â”€â”€ utils/              # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ encoders.py      # JSON ç¼–ç å™¨
â”‚       â”œâ”€â”€ async_helpers.py # å¼‚æ­¥è¾…åŠ©å·¥å…·
â”‚       â””â”€â”€ strategy_registry.py # ç­–ç•¥æ³¨å†Œè¡¨
â”œâ”€â”€ landing-page/            # React/Next.js å‰ç«¯
â”‚   â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”‚   â””â”€â”€ (app)/
â”‚   â”‚       â””â”€â”€ backtest/    # å›æµ‹é¡µé¢
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â””â”€â”€ backtest/        # å›æµ‹ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                 # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ api.ts           # API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ hooks/           # React Hooks
â”‚   â”‚       â””â”€â”€ useBacktestWebSocket.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ nginx.conf               # Nginx é…ç½®
â”œâ”€â”€ start.sh                 # å¯åŠ¨è„šæœ¬
â””â”€â”€ stop.sh                  # åœæ­¢è„šæœ¬
```

### æ¶æ„æ”¹è¿› (2025å¹´2æœˆé‡æ„)

#### RuleParser æ¨¡å—åŒ– (1061è¡Œ â†’ 7ä¸ªç»„ä»¶)
- **ExpressionContext** - ä¸å¯å˜çš„è¯„ä¼°ä¸Šä¸‹æ–‡æ•°æ®ç±»
- **ASTNodeHandler** - æ— çŠ¶æ€ASTèŠ‚ç‚¹æ“ä½œå·¥å…·
- **RuleCacheManager** - LRUç¼“å­˜ç®¡ç†å™¨ (æ—¶é—´ç›¸å…³/æ— å…³åˆ†ç¦»)
- **ResultStorageManager** - DataFrameåˆ—å­˜å‚¨ç®¡ç†
- **CrossSectionalRanker** - æ¨ªæˆªé¢æ’åé€»è¾‘
- **RuleEvaluator** - è¡¨è¾¾å¼è¯„ä¼°æ ¸å¿ƒé€»è¾‘
- **RuleParser (é—¨é¢)** - å‘åå…¼å®¹çš„ç»Ÿä¸€å…¥å£

#### API Router æ¨¡å—åŒ– (1408è¡Œ â†’ 5ä¸ªå­æ¨¡å—)
- **execution.py** - å›æµ‹æ‰§è¡Œç«¯ç‚¹
- **results.py** - ç»“æœæŸ¥è¯¢ç«¯ç‚¹ (6ä¸ª)
- **configs.py** - é…ç½®ç®¡ç†ç«¯ç‚¹ (6ä¸ª)
- **custom_strategies.py** - è‡ªå®šä¹‰ç­–ç•¥ç«¯ç‚¹ (6ä¸ª)
- **logs.py** - æ—¥å¿—æŸ¥è¯¢ç«¯ç‚¹
- **models/** - ç»Ÿä¸€çš„Pydanticæ¨¡å‹ç»„ç»‡

### äº‹ä»¶é©±åŠ¨æ¶æ„

ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨è®¾è®¡ï¼Œä¸»è¦äº‹ä»¶ç±»å‹ï¼š
- `MarketDataEvent` - å¸‚åœºæ•°æ®äº‹ä»¶
- `SignalEvent` - ç­–ç•¥ä¿¡å·äº‹ä»¶
- `OrderEvent` - è®¢å•äº‹ä»¶
- `FillEvent` - æˆäº¤å›æŠ¥äº‹ä»¶

### æ•°æ®æµ

1. **æ•°æ®è·å–** â†’ æ•°æ®ç®¡ç†å™¨ â†’ æŒ‡æ ‡è®¡ç®—
2. **ç­–ç•¥å¼•æ“** â†’ ä¿¡å·ç”Ÿæˆ â†’ é£é™©éªŒè¯ â†’ è®¢å•æ‰§è¡Œ
3. **äº¤æ˜“æ‰§è¡Œ** â†’ æŒä»“æ›´æ–° â†’ ç»„åˆç®¡ç† â†’ ä¸šç»©è¯„ä¼°

### å¼‚æ­¥å›æµ‹æµç¨‹

1. **å‰ç«¯å‘èµ·** â†’ POST /api/backtest/run
2. **åˆ›å»ºä»»åŠ¡** â†’ BacktestTaskManager æäº¤åå°ä»»åŠ¡
3. **çŠ¶æ€å­˜å‚¨** â†’ Redis ä¿å­˜å›æµ‹çŠ¶æ€
4. **æ‰§è¡Œå›æµ‹** â†’ BacktestEngine å¼‚æ­¥æ‰§è¡Œ
5. **è¿›åº¦æ¨é€** â†’ WebSocket å®æ—¶æ¨é€è¿›åº¦
6. **å‰ç«¯å±•ç¤º** â†’ è¿›åº¦æ¡æ˜¾ç¤º + ç»“æœå±•ç¤º

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯æ ˆ | ç”¨é€” |
|------|--------|------|
| **å‰ç«¯** | React 18, Next.js 14, Tailwind CSS | ç”¨æˆ·ç•Œé¢ |
| **åç«¯** | FastAPI, Python 3.12+ | API æœåŠ¡ |
| **é€šä¿¡** | WebSocket, HTTP/REST | å®æ—¶é€šä¿¡ |
| **ç¼“å­˜** | Redis 7.0+ | çŠ¶æ€å­˜å‚¨ |
| **ä»£ç†** | Nginx 1.24+ | åå‘ä»£ç† |
| **æ•°æ®åº“** | SQLite, PostgreSQL | æ•°æ®æŒä¹…åŒ– |
| **ä»»åŠ¡** | FastAPI BackgroundTasks | å¼‚æ­¥æ‰§è¡Œ |

## ğŸ“ˆ ä½¿ç”¨ç¤ºä¾‹

### ç­–ç•¥å›æµ‹

```python
from src.core.strategy.backtesting import BacktestConfig, BacktestEngine

# åˆ›å»ºå›æµ‹é…ç½®
config = BacktestConfig(
    start_date="2023-01-01",
    end_date="2024-01-01",
    target_symbol="000001.SZ",
    initial_capital=100000,
    position_strategy_type="fixed_percent",
    position_strategy_params={"percent": 0.1}
)

# æ‰§è¡Œå›æµ‹
engine = BacktestEngine(config)
results = engine.run()
```

### è§„åˆ™ç­–ç•¥

```python
# å®šä¹‰äº¤æ˜“è§„åˆ™
rules = {
    "buy_rule": "CLOSE > MA(CLOSE, 20) AND MA(CLOSE, 5) > MA(CLOSE, 20)",
    "sell_rule": "CLOSE < MA(CLOSE, 10)"
}
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç­–ç•¥

1. ç»§æ‰¿ `BaseStrategy` ç±»
2. å®ç° `generate_signals` æ–¹æ³•
3. æ³¨å†Œåˆ°ç­–ç•¥å·¥å‚

```python
from src.core.strategy.strategy import BaseStrategy

class MyCustomStrategy(BaseStrategy):
    def generate_signals(self, data):
        # å®ç°ç­–ç•¥é€»è¾‘
        return signals
```

### æ·»åŠ æ–°æŒ‡æ ‡

1. ç»§æ‰¿ `Indicator` ç±»
2. å®ç°è®¡ç®—é€»è¾‘
3. æ³¨å†Œåˆ°æŒ‡æ ‡å·¥å‚

```python
from src.services.chart_service import Indicator

class CustomIndicator(Indicator):
    def calculate(self, data):
        # å®ç°æŒ‡æ ‡è®¡ç®—
        return result
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

ç³»ç»Ÿæä¾›å®Œæ•´çš„æ€§èƒ½åˆ†æï¼š
- **å¹´åŒ–æ”¶ç›Šç‡** - ç­–ç•¥å¹´åŒ–æ”¶ç›Šè¡¨ç°
- **å¤æ™®æ¯”ç‡** - é£é™©è°ƒæ•´åæ”¶ç›Š
- **æœ€å¤§å›æ’¤** - æœ€å¤§äºæŸå¹…åº¦
- **èƒœç‡** - äº¤æ˜“æˆåŠŸæ¯”ä¾‹
- **ç›ˆäºæ¯”** - å¹³å‡ç›ˆåˆ©/å¹³å‡äºæŸ

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦æƒ…ã€‚

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache 2.0 è®¸å¯è¯ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

Copyright 2025 QuantOL Project

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

## ğŸ™ è‡´è°¢

### æ ¸å¿ƒæŠ€æœ¯
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ– Python Web æ¡†æ¶
- [React](https://react.dev/) - ç”¨æˆ·ç•Œé¢åº“
- [Next.js](https://nextjs.org/) - React åº”ç”¨æ¡†æ¶
- [WebSocket](https://websockets.ws/) - å®æ—¶åŒå‘é€šä¿¡
- [Redis](https://redis.io/) - å†…å­˜æ•°æ®åº“å’Œç¼“å­˜
- [Nginx](https://nginx.org/) - é«˜æ€§èƒ½åå‘ä»£ç†
- [Streamlit](https://streamlit.io/) - ä¼˜ç§€çš„Webåº”ç”¨æ¡†æ¶

### æ•°æ®æº
- [Baostock](http://baostock.com/) - å…è´¹Aè‚¡æ•°æ®æº
- [AkShare](https://github.com/akfamily/akshare) - å¤šå¸‚åœºæ•°æ®æ¥å£
- [Tushare](https://tushare.pro/) - ä¸“ä¸šé‡‘èæ•°æ®æ¥å£

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- é¡¹ç›® Issues: [GitHub Issues](https://github.com/FAKE0704/QuantOL/issues)
- é‚®ç®±: pengfeigaofake@gmail.com
- å¾®ä¿¡: ThomasGao0704

---


â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ª Starï¼



